<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pictures to PDF Generator</title>
<link rel="icon" href="https://raw.githubusercontent.com/pgarciafer/pics2PDF/main/logo1.png" type="image/png">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --primary-blue: #0069d9;
    --dark-blue: #004c99;
    --light-gray: #f8f9fa;
    --medium-gray: #e9ecef;
    --dark-text: #343a40;
    --red-error: #dc3545;
  }
  body {
    font-family: 'Poppins', sans-serif;
    background-color: var(--light-gray);
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }
  .container {
    max-width: 700px;
    width: 95%;
    margin: 10px;
    padding: 15px;
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  }
  .header-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    border-bottom: 3px solid var(--medium-gray);
    padding-bottom: 15px;
  }
  .header-title {
    display: flex;
    align-items: center;
  }
  .header-title img {
    height: 60px;
    vertical-align: middle;
    margin-right: 15px;
  }
  .header-title span {
    color: var(--dark-text);
    font-size: 20px;
    font-weight: 600;
  }
  .remove-btn {
    background-color: #ff6666;
  }
  .remove-btn:hover {
    background-color: #e65c5c;
  }
  .remove-btn:disabled {
    background-color: #ced4da;
  }
  .contact-btn {
    padding: 8px 12px;
    background-color: var(--primary-blue);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    text-decoration: none;
    transition: background-color 0.3s;
  }
  .contact-btn:hover {
    background-color: var(--dark-blue);
  }
  label {
    display: block;
    margin-top: 10px;
    font-weight: 600;
    color: var(--dark-text);
    font-size: 13px;
  }
  input, select, textarea {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    border-radius: 6px;
    border: 1px solid var(--medium-gray);
    font-size: 13px;
    box-sizing: border-box;
    transition: border-color 0.3s, box-shadow 0.3s;
  }
  input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: var(--primary-blue);
    box-shadow: 0 0 0 2px rgba(0, 105, 217, 0.25);
  }
  input[type="file"] {
    padding: 8px;
  }
  .drop-zone {
    border: 3px dashed var(--primary-blue);
    background: #e6f0ff;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    margin-bottom: 15px;
    border-radius: 8px;
    transition: background 0.3s, border-color 0.3s;
  }
  .drop-zone-section {
	display: flex;
	align-items: center;
	gap: 15px;
	margin-bottom: 15px;
}

.drop-zone-section .drop-zone {
  flex: 1;
}

.drop-zone-section .remove-btn {
  height: 100%;
  width: 12px; /* fixed width for buttons */
}

  .drop-zone:hover {
    background: #cce0ff;
    border-color: var(--dark-blue);
  }
  .drop-zone p {
    font-size: 14px;
    color: var(--dark-blue);
    margin: 0;
  }
  .image-list-container {
    border: 1px solid var(--medium-gray);
    min-height: 100px;
    max-height: 150px;
    overflow-y: auto;
    padding: 10px;
    margin-bottom: 15px;
    border-radius: 6px;
    background: #fafafa;
    display: none;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: flex-start;
  }
  .image-item {
    width: 50px;
    height: 50px;
    object-fit: contain;
    border: 1px solid var(--medium-gray);
    border-radius: 6px;
    padding: 5px;
    background: #fff;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }
  .attachment-section {
    margin-top: 30px; /* spacing from images section */
  }
  .attachment-list-container {
    border: 1px solid var(--medium-gray);
    min-height: 50px;
    max-height: 100px;
    overflow-y: auto;
    padding: 10px;
    margin-bottom: 15px;
    border-radius: 6px;
    background: #fafafa;
    display: none;
  }
  .attachment-item {
    font-size: 12px;
    color: var(--dark-text);
    padding: 5px 0;
    border-bottom: 1px solid var(--medium-gray);
  }
  .attachment-item:last-child {
    border-bottom: none;
  }
  .button-group {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 15px;
  }
  button {
    flex: 1;
    padding: 10px 15px;
    background-color: var(--primary-blue);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    transition: background-color 0.3s, transform 0.1s;
  }
  button:hover {
    background-color: var(--dark-blue);
  }
  button:disabled {
    background-color: #ced4da;
    cursor: not-allowed;
  }
  .required-label {
    color: var(--red-error);
  }
  .invalid {
    border: 2px solid var(--red-error) !important;
  }
  .status-message {
    text-align: center;
    margin-top: 10px;
    font-size: 12px;
    color: var(--dark-text);
  }
  @media (max-width: 600px) {
    .container {
      padding: 15px;
      margin: 10px;
    }
    .header-container {
      flex-direction: column;
      align-items: center;
    }
    .header-title {
      flex-direction: column;
      margin-bottom: 10px;
    }
    .contact-btn {
      width: 100%;
      text-align: center;
    }
    .button-group button {
      flex: 1 1 100%;
    }
  }
</style>
</head>
<body>
<div class="container">
<div class="header-container">
  <div class="header-title">
    <a href="https://www.mtnsat.com" target="_blank">
      <img src="https://raw.githubusercontent.com/pgarciafer/pics2PDF/main/logo.png" alt="Logo">
    </a>
    <span>Pictures Array to PDF</span>
  </div>
  <a href="contact.html" class="contact-btn">Contact</a>
</div>



<!-- Pictures section -->
<div class="drop-zone-section">
  <div class="drop-zone" id="dropZone">
    <p>üìÅ Pictures here</p>
  </div>
  <button id="removeAllBtn" class="remove-btn">Remove All Images</button>
</div>

<div class="image-list-container" id="imageListContainer"></div>





<!-- Attachments section -->
<div class="attachment-section">
  <div class="drop-zone-section">
    <div class="drop-zone" id="attachmentsDropZone">
      <p>üìé Attachments Here</p>
    </div>
    <button id="removeAllAttachmentsBtn" class="remove-btn">Remove All Attachments</button>
  </div>
  
  <div class="attachment-list-container" id="attachmentListContainer"></div>
</div>







<label for="vesselName">3LC_VesselName: <span class="required-label">*</span></label>
<input type="text" id="vesselName" placeholder="e.g., NCL_RoyalClipper">

<label for="antennaModel">AntennaBrandModel_SNxxx: <span class="required-label">*</span></label>
<input type="text" id="antennaModel" placeholder="e.g., Intellian-v100_SN24536">

<label for="antennaLocation">Antenna Location: <span class="required-label">*</span></label>
<input type="text" id="antennaLocation" placeholder="e.g., Deck 1 Starboard">

<label for="caseNumber">Case Number: <span class="required-label">*</span></label>
<input type="tel" id="caseNumber" inputmode="numeric" pattern="[0-9]*" placeholder="e.g., 35234">

<label for="submittedBy">Submitted By: <span class="required-label">*</span></label>
<input type="text" id="submittedBy" placeholder="e.g., Pablo Garcia">

<label for="dateField">Date: <span class="required-label">*</span></label>
<input type="date" id="dateField">

<label for="imagesPerPage">Images per page (1-4):</label>
<select id="imagesPerPage">
  <option value="1">1</option>
  <option value="2" selected>2</option>
  <option value="3">3</option>
  <option value="4">4</option>
</select>

<div class="button-group">
  <button id="generatePDF">Generate PDF & ZIP</button>
</div>

<div class="status-message" id="statusMessage"></div>
</div>

<script>
const { jsPDF } = window.jspdf;
let images = [];
let attachments = [];
const dropZone = document.getElementById('dropZone');
const imageListContainer = document.getElementById('imageListContainer');
const attachmentsDropZone = document.getElementById('attachmentsDropZone');
const attachmentListContainer = document.getElementById('attachmentListContainer');
const generateBtn = document.getElementById('generatePDF');
const statusMessage = document.getElementById('statusMessage');

// Default date
document.getElementById("dateField").value = new Date().toISOString().split("T")[0];

// Drag-drop for images
dropZone.addEventListener('click', () => {
  const fileInput = document.createElement('input');
  fileInput.type = 'file';
  fileInput.multiple = true;
  fileInput.accept = 'image/*';
  fileInput.onchange = () => addImages(fileInput.files);
  fileInput.click();
});
dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.style.backgroundColor = "#cce0ff"; });
dropZone.addEventListener('dragleave', e => { e.preventDefault(); dropZone.style.backgroundColor = "#e6f0ff"; });
dropZone.addEventListener('drop', e => { e.preventDefault(); dropZone.style.backgroundColor = "#e6f0ff"; addImages(e.dataTransfer.files); });

function addImages(fileList){
  if(fileList.length > 0) imageListContainer.style.display = 'flex';
  Array.from(fileList).forEach(file => {
    if(file.type.startsWith('image/')){
      images.push(file);
      const img = document.createElement('img');
      img.src = URL.createObjectURL(file);
      img.classList.add('image-item');
      imageListContainer.appendChild(img);
    }
  });
}
document.getElementById('removeAllBtn').addEventListener('click', () => {
  images = [];
  imageListContainer.innerHTML = '';
  imageListContainer.style.display = 'none';
  statusMessage.textContent = 'All images removed.';
});

// Drag-drop for attachments
attachmentsDropZone.addEventListener('click', () => {
  const fileInput = document.createElement('input');
  fileInput.type = 'file';
  fileInput.multiple = true;
  fileInput.onchange = () => addAttachments(fileInput.files);
  fileInput.click();
});
attachmentsDropZone.addEventListener('dragover', e => { e.preventDefault(); attachmentsDropZone.style.backgroundColor = "#cce0ff"; });
attachmentsDropZone.addEventListener('dragleave', e => { e.preventDefault(); attachmentsDropZone.style.backgroundColor = "#e6f0ff"; });
attachmentsDropZone.addEventListener('drop', e => { e.preventDefault(); attachmentsDropZone.style.backgroundColor = "#e6f0ff"; addAttachments(e.dataTransfer.files); });

function addAttachments(fileList){
  if(fileList.length > 0) attachmentListContainer.style.display = 'block';
  Array.from(fileList).forEach(file => {
    attachments.push(file);
    const item = document.createElement('div');
    item.textContent = file.name;
    item.classList.add('attachment-item');
    attachmentListContainer.appendChild(item);
  });
}
document.getElementById('removeAllAttachmentsBtn').addEventListener('click', () => {
  attachments = [];
  attachmentListContainer.innerHTML = '';
  attachmentListContainer.style.display = 'none';
  statusMessage.textContent = 'All attachments removed.';
});

// PDF generation
generateBtn.addEventListener('click', async () => {
  statusMessage.textContent = '';
  generateBtn.disabled = true;

  const requiredIds = ["vesselName", "antennaModel", "antennaLocation", "caseNumber", "submittedBy", "dateField"];
  let valid = true;
  requiredIds.forEach(id => {
    const f = document.getElementById(id);
    if (!f.value.trim()) {
      f.classList.add("invalid");
      valid = false;
    } else {
      f.classList.remove("invalid");
    }
  });
  if (!valid) {
    statusMessage.textContent = "Please fill all required fields!";
    generateBtn.disabled = false;
    return;
  }
  if (images.length === 0 && attachments.length === 0) {
    statusMessage.textContent = "Add at least one image or attachment.";
    generateBtn.disabled = false;
    return;
  }

  statusMessage.textContent = "Generating PDF...";

  const vessel = document.getElementById('vesselName').value.trim();
  const antenna = document.getElementById('antennaModel').value.trim();
  const location = document.getElementById('antennaLocation').value.trim().toUpperCase(); // <-- Converted to uppercase here
  const caseNum = document.getElementById('caseNumber').value.trim();
  const submitted = document.getElementById('submittedBy').value.trim();
  const dateStr = document.getElementById('dateField').value;
  const perPage = parseInt(document.getElementById('imagesPerPage').value);

  const pdf = new jsPDF({
    orientation: 'landscape',
    unit: 'pt',
    format: 'a4'
  });
  const pageWidth = pdf.internal.pageSize.getWidth();
  const pageHeight = pdf.internal.pageSize.getHeight();

  // Cover page
  const logoUrl = 'https://raw.githubusercontent.com/pgarciafer/pics2PDF/main/logo.png';
  const logo = await loadImage(logoUrl);
  if (logo) {
    const logoWidth = 350;
    const logoHeight = (logo.height * logoWidth) / logo.width;
    pdf.addImage(logo, 'PNG', (pageWidth - logoWidth) / 2, 50, logoWidth, logoHeight);
  }
  pdf.setFontSize(26).setFont('helvetica', 'bold');
  pdf.text(vessel, pageWidth / 2, 250, {
    align: 'center'
  });
  pdf.setFontSize(22);
  pdf.text(`${antenna} (${location})`, pageWidth / 2, 290, {
    align: 'center'
  });
  pdf.setFontSize(18);
  pdf.text(`Case Number: ${caseNum}`, pageWidth / 2, 330, {
    align: 'center'
  });
  pdf.setFontSize(14);
  pdf.text(`Submitted By: ${submitted}`, pageWidth / 2, 360, {
    align: 'center'
  });
  pdf.text(`Date: ${dateStr}`, pageWidth / 2, 385, {
    align: 'center'
  });

  if (images.length > 0 || attachments.length > 0) pdf.addPage();

  let pageNum = 2;
  for (let i = 0; i < images.length; i += perPage) {
    const chunk = images.slice(i, i + perPage);
    const spacingX = 10,
      spacingY = 10;
    let cellWidth, cellHeight;
    if (perPage === 1) {
      cellWidth = pageWidth - 2 * spacingX;
      cellHeight = pageHeight - 2 * spacingY;
      await addImageToPDF(pdf, chunk[0], spacingX, spacingY, cellWidth, cellHeight);
    } else if (perPage === 4) {
      cellWidth = (pageWidth - 3 * spacingX) / 2;
      cellHeight = (pageHeight - 3 * spacingY) / 2;
      for (let idx = 0; idx < chunk.length; idx++) {
        let row = Math.floor(idx / 2),
          col = idx % 2;
        await addImageToPDF(pdf, chunk[idx],
          spacingX + col * (cellWidth + spacingX),
          spacingY + row * (cellHeight + spacingY),
          cellWidth, cellHeight);
      }
    } else {
      cellWidth = (pageWidth - (perPage + 1) * spacingX) / perPage;
      cellHeight = pageHeight - 2 * spacingY;
      for (let idx = 0; idx < chunk.length; idx++) {
        await addImageToPDF(pdf, chunk[idx],
          spacingX + idx * (cellWidth + spacingX), spacingY,
          cellWidth, cellHeight);
      }
    }
    pdf.setFontSize(12).text(`Page ${pageNum}`, pageWidth / 2, pageHeight - 10, {
      align: 'center'
    });
    if (i + perPage < images.length) pdf.addPage();
    pageNum++;
  }

  // Attachments listing
  if (attachments.length > 0) {
    if (images.length > 0) pdf.addPage();
    pdf.setFontSize(20).setFont('helvetica', 'bold');
    pdf.text("Attached Files", pageWidth / 2, 30, {
      align: 'center'
    });
    pdf.setFontSize(10).setFont('helvetica', 'normal');
    let startY = 60,
      iconSize = 20,
      padding = 20;
    for (const att of attachments) {
      pdf.text(`üìé ${att.name}`, padding, startY);
      startY += iconSize + 10;
      if (startY > pageHeight - padding) {
        pdf.addPage();
        startY = 40;
      }
    }
    pdf.setFontSize(12).text(`Page ${pageNum}`, pageWidth / 2, pageHeight - 10, {
      align: 'center'
    });
  }

  // Generate filename with desired format
  const dateFormatted = dateStr.replace(/-/g, '');
  const filenamePrefix = `${vessel}_PicArray_${antenna}_${location.replace(/ /g, '')}_Case${caseNum}_${dateFormatted}`;
  const pdfFilename = `${filenamePrefix}.pdf`;
  const zipFilename = `${filenamePrefix}.zip`;

  // Conditional PDF/ZIP generation logic
  if (attachments.length > 0) {
    statusMessage.textContent = "Generating ZIP...";
    const zip = new JSZip();
    const pdfBlob = pdf.output('blob');
    zip.file(pdfFilename, pdfBlob);
    for (const att of attachments) {
      zip.file(att.name, att);
    }
    const zipBlob = await zip.generateAsync({
      type: 'blob'
    });
    saveAs(zipBlob, zipFilename);
    statusMessage.textContent = 'ZIP (PDF + attachments) generated successfully!';
  } else {
    // Only save the PDF if no attachments are present
    const pdfBlob = pdf.output('blob');
    saveAs(pdfBlob, pdfFilename);
    statusMessage.textContent = 'PDF generated successfully!';
  }

  generateBtn.disabled = false;
});

// Helpers
function fileToDataURL(file){
  return new Promise(res=>{
    const reader=new FileReader();
    reader.onload=()=>res(reader.result);
    reader.readAsDataURL(file);
  });
}
function loadImage(src){
  return new Promise(res=>{
    const img=new Image();
    img.crossOrigin='Anonymous';
    img.src=src;
    img.onload=()=>res(img);
    img.onerror=()=>res(null);
  });
}
async function addImageToPDF(pdf,file,x,y,width,height){
  let src=file instanceof File?await fileToDataURL(file):file;
  const img=await loadImage(src); if(!img) return;
  const canvas=document.createElement('canvas'),ctx=canvas.getContext('2d');
  let maxDim=1000,scale=Math.min(maxDim/img.width,maxDim/img.height,1);
  canvas.width=img.width*scale; canvas.height=img.height*scale;
  ctx.drawImage(img,0,0,canvas.width,canvas.height);
  const compressed=canvas.toDataURL('image/jpeg',0.7);
  const cellAspect=width/height, imgAspect=img.width/img.height;
  let finalW,finalH;
  if(imgAspect>cellAspect){finalW=width*0.95; finalH=finalW/imgAspect;}
  else {finalH=height*0.95; finalW=finalH*imgAspect;}
  pdf.addImage(compressed,'JPEG',x+(width-finalW)/2,y+(height-finalH)/2,finalW,finalH);
}
</script>
</body>
</html>
